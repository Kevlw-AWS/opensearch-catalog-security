{"id":"3d8dec29-a911-48f5-beb1-7b10001dd892","createdAt":1706159238006,"updatedAt":1706159401012,"text":"\n#This is a workflows based integration in which the RED's needed indices are being build as workflow steps\n# The RED Method defines the three key metrics you should measure for every microservice in your architecture. Those metrics are:\n\n# (Request) Rate - the number of requests, per second, you services are serving.\n# (Request) Errors - the number of failed requests per second.\n# (Request) Duration - distributions of the amount of time each request takes.\n\n# ------------------------------------------------------------------------------------------------------------------------------------\n#\n# The workflow includes the following steps\n#  - create a new `otel-v1-apm-spam-*` index to append the `@timestamp` mapping \n# - `reindex` the `otel-v1-apm-spam-*` to the new index\n# - setup rollup job to prepare the RED services metrics dimensions and metrics\n\n# ------------------------------------------------------------------------------------------------------------------------------------\n#\n# This specific RED services rollup index is generated to answer the following questions:\n# - average duration by service in hourly time bucket\n# - max duration by service in hourly time bucket\n# - success count by service by http status code in hourly time bucket\n# - errors count by service by http status code in hourly time bucket\n# - total requests count by service by http status code in hourly time bucket\n\n\n# For Additional Information visit : https://github.com/opensearch-project/opensearch-catalog/integrations/observability/reds-services-workflow/info\n# ------------------------------------------------------------------------------------------------------------------------------------\n# Create a new index with the additional @timestamp field \nPUT  /otel-v1-apm-span-fixed\n{\n  \"mappings\": {\n    \"dynamic_templates\": [\n      {\n        \"resource_attributes_map\": {\n          \"path_match\": \"resource.attributes.*\",\n          \"mapping\": {\n            \"type\": \"keyword\"\n          }\n        }\n      },\n      {\n        \"span_attributes_map\": {\n          \"path_match\": \"span.attributes.*\",\n          \"mapping\": {\n            \"type\": \"keyword\"\n          }\n        }\n      }\n    ],\n    \"date_detection\": false,\n    \"properties\": {\n      \"droppedAttributesCount\": {\n        \"type\": \"long\"\n      },\n      \"droppedEventsCount\": {\n        \"type\": \"long\"\n      },\n      \"droppedLinksCount\": {\n        \"type\": \"long\"\n      },\n      \"durationInNanos\": {\n        \"type\": \"long\"\n      },\n      \"endTime\": {\n        \"type\": \"date_nanos\"\n      },\n      \"events\": {\n        \"type\": \"nested\",\n        \"properties\": {\n          \"attributes\": {\n            \"properties\": {\n              \"app@payment@transaction@id\": {\n                \"type\": \"text\",\n                \"fields\": {\n                  \"keyword\": {\n                    \"type\": \"keyword\",\n                    \"ignore_above\": 256\n                  }\n                }\n              },\n              \"app@quote@cost@total\": {\n                \"type\": \"float\"\n              },\n              \"app@shipping@cost@total\": {\n                \"type\": \"text\",\n                \"fields\": {\n                  \"keyword\": {\n                    \"type\": \"keyword\",\n                    \"ignore_above\": 256\n                  }\n                }\n              },\n              \"app@shipping@tracking@id\": {\n                \"type\": \"text\",\n                \"fields\": {\n                  \"keyword\": {\n                    \"type\": \"keyword\",\n                    \"ignore_above\": 256\n                  }\n                }\n              },\n              \"exception@escaped\": {\n                \"type\": \"text\",\n                \"fields\": {\n                  \"keyword\": {\n                    \"type\": \"keyword\",\n                    \"ignore_above\": 256\n                  }\n                }\n              },\n              \"exception@message\": {\n                \"type\": \"text\",\n                \"fields\": {\n                  \"keyword\": {\n                    \"type\": \"keyword\",\n                    \"ignore_above\": 256\n                  }\n                }\n              },\n              \"exception@stacktrace\": {\n                \"type\": \"text\",\n                \"fields\": {\n                  \"keyword\": {\n                    \"type\": \"keyword\",\n                    \"ignore_above\": 256\n                  }\n                }\n              },\n              \"exception@type\": {\n                \"type\": \"text\",\n                \"fields\": {\n                  \"keyword\": {\n                    \"type\": \"keyword\",\n                    \"ignore_above\": 256\n                  }\n                }\n              },\n              \"message@id\": {\n                \"type\": \"long\"\n              },\n              \"message@type\": {\n                \"type\": \"text\",\n                \"fields\": {\n                  \"keyword\": {\n                    \"type\": \"keyword\",\n                    \"ignore_above\": 256\n                  }\n                }\n              },\n              \"message@uncompressed_size\": {\n                \"type\": \"long\"\n              }\n            }\n          },\n          \"droppedAttributesCount\": {\n            \"type\": \"long\"\n          },\n          \"name\": {\n            \"type\": \"text\",\n            \"fields\": {\n              \"keyword\": {\n                \"type\": \"keyword\",\n                \"ignore_above\": 256\n              }\n            }\n          },\n          \"time\": {\n            \"type\": \"date_nanos\"\n          }\n        }\n      },\n      \"instrumentationScope\": {\n        \"properties\": {\n          \"name\": {\n            \"type\": \"text\",\n            \"fields\": {\n              \"keyword\": {\n                \"type\": \"keyword\",\n                \"ignore_above\": 256\n              }\n            }\n          },\n          \"version\": {\n            \"type\": \"text\",\n            \"fields\": {\n              \"keyword\": {\n                \"type\": \"keyword\",\n                \"ignore_above\": 256\n              }\n            }\n          }\n        }\n      },\n      \"kind\": {\n        \"type\": \"keyword\",\n        \"ignore_above\": 128\n      },\n      \"links\": {\n        \"type\": \"nested\",\n        \"properties\": {\n          \"attributes\": {\n            \"type\": \"object\"\n          },\n          \"droppedAttributesCount\": {\n            \"type\": \"long\"\n          },\n          \"spanId\": {\n            \"type\": \"text\",\n            \"fields\": {\n              \"keyword\": {\n                \"type\": \"keyword\",\n                \"ignore_above\": 256\n              }\n            }\n          },\n          \"traceId\": {\n            \"type\": \"text\",\n            \"fields\": {\n              \"keyword\": {\n                \"type\": \"keyword\",\n                \"ignore_above\": 256\n              }\n            }\n          },\n          \"traceState\": {\n            \"type\": \"text\",\n            \"fields\": {\n              \"keyword\": {\n                \"type\": \"keyword\",\n                \"ignore_above\": 256\n              }\n            }\n          }\n        }\n      },\n      \"name\": {\n        \"type\": \"keyword\",\n        \"ignore_above\": 1024\n      },\n      \"parentSpanId\": {\n        \"type\": \"keyword\",\n        \"ignore_above\": 256\n      },\n      \"resource\": {\n        \"properties\": {\n          \"attributes\": {\n            \"properties\": {\n              \"cloud@account@id\": {\n                \"type\": \"keyword\"\n              },\n              \"cloud@availability_zone\": {\n                \"type\": \"keyword\"\n              },\n              \"cloud@platform\": {\n                \"type\": \"keyword\"\n              },\n              \"cloud@provider\": {\n                \"type\": \"keyword\"\n              },\n              \"cloud@region\": {\n                \"type\": \"keyword\"\n              },\n              \"container@id\": {\n                \"type\": \"keyword\"\n              },\n              \"host@arch\": {\n                \"type\": \"keyword\"\n              },\n              \"host@id\": {\n                \"type\": \"keyword\"\n              },\n              \"host@name\": {\n                \"type\": \"keyword\"\n              },\n              \"host@type\": {\n                \"type\": \"keyword\"\n              },\n              \"k8s@namespace@name\": {\n                \"type\": \"keyword\"\n              },\n              \"k8s@node@name\": {\n                \"type\": \"keyword\"\n              },\n              \"k8s@pod@name\": {\n                \"type\": \"keyword\"\n              },\n              \"os@description\": {\n                \"type\": \"keyword\"\n              },\n              \"os@name\": {\n                \"type\": \"keyword\"\n              },\n              \"os@type\": {\n                \"type\": \"keyword\"\n              },\n              \"os@version\": {\n                \"type\": \"keyword\"\n              },\n              \"process@command\": {\n                \"type\": \"keyword\"\n              },\n              \"process@command_args\": {\n                \"type\": \"keyword\"\n              },\n              \"process@command_line\": {\n                \"type\": \"keyword\"\n              },\n              \"process@executable@name\": {\n                \"type\": \"keyword\"\n              },\n              \"process@executable@path\": {\n                \"type\": \"keyword\"\n              },\n              \"process@owner\": {\n                \"type\": \"keyword\"\n              },\n              \"process@pid\": {\n                \"type\": \"keyword\"\n              },\n              \"process@runtime@description\": {\n                \"type\": \"keyword\"\n              },\n              \"process@runtime@name\": {\n                \"type\": \"keyword\"\n              },\n              \"process@runtime@version\": {\n                \"type\": \"keyword\"\n              },\n              \"service@instance@id\": {\n                \"type\": \"keyword\"\n              },\n              \"service@name\": {\n                \"type\": \"keyword\"\n              },\n              \"service@namespace\": {\n                \"type\": \"keyword\"\n              },\n              \"telemetry@auto@version\": {\n                \"type\": \"keyword\"\n              },\n              \"telemetry@sdk@language\": {\n                \"type\": \"keyword\"\n              },\n              \"telemetry@sdk@name\": {\n                \"type\": \"keyword\"\n              },\n              \"telemetry@sdk@version\": {\n                \"type\": \"keyword\"\n              }\n            }\n          }\n        }\n      },\n      \"serviceName\": {\n        \"type\": \"keyword\"\n      },\n      \"span\": {\n        \"properties\": {\n          \"attributes\": {\n            \"properties\": {\n              \"app@ads@ad_request_type\": {\n                \"type\": \"keyword\"\n              },\n              \"app@ads@ad_response_type\": {\n                \"type\": \"keyword\"\n              },\n              \"app@ads@category\": {\n                \"type\": \"keyword\"\n              },\n              \"app@ads@contextKeys\": {\n                \"type\": \"keyword\"\n              },\n              \"app@ads@contextKeys@count\": {\n                \"type\": \"keyword\"\n              },\n              \"app@ads@count\": {\n                \"type\": \"keyword\"\n              },\n              \"app@cart@items@count\": {\n                \"type\": \"keyword\"\n              },\n              \"app@currency@conversion@from\": {\n                \"type\": \"keyword\"\n              },\n              \"app@currency@conversion@to\": {\n                \"type\": \"keyword\"\n              },\n              \"app@email@recipient\": {\n                \"type\": \"keyword\"\n              },\n              \"app@featureflag@enabled\": {\n                \"type\": \"keyword\"\n              },\n              \"app@featureflag@name\": {\n                \"type\": \"keyword\"\n              },\n              \"app@filtered_products@count\": {\n                \"type\": \"keyword\"\n              },\n              \"app@filtered_products@list\": {\n                \"type\": \"keyword\"\n              },\n              \"app@order@amount\": {\n                \"type\": \"keyword\"\n              },\n              \"app@order@id\": {\n                \"type\": \"keyword\"\n              },\n              \"app@order@items@count\": {\n                \"type\": \"keyword\"\n              },\n              \"app@payment@amount\": {\n                \"type\": \"keyword\"\n              },\n              \"app@payment@card_type\": {\n                \"type\": \"keyword\"\n              },\n              \"app@payment@card_valid\": {\n                \"type\": \"keyword\"\n              },\n              \"app@payment@charged\": {\n                \"type\": \"keyword\"\n              },\n              \"app@product@id\": {\n                \"type\": \"keyword\"\n              },\n              \"app@product@name\": {\n                \"type\": \"keyword\"\n              },\n              \"app@product@quantity\": {\n                \"type\": \"keyword\"\n              },\n              \"app@products@count\": {\n                \"type\": \"keyword\"\n              },\n              \"app@products_recommended@count\": {\n                \"type\": \"keyword\"\n              },\n              \"app@quote@cost@total\": {\n                \"type\": \"keyword\"\n              },\n              \"app@quote@items@count\": {\n                \"type\": \"keyword\"\n              },\n              \"app@recommendation@cache_enabled\": {\n                \"type\": \"keyword\"\n              },\n              \"app@shipping@amount\": {\n                \"type\": \"keyword\"\n              },\n              \"app@shipping@cost@total\": {\n                \"type\": \"keyword\"\n              },\n              \"app@shipping@items@count\": {\n                \"type\": \"keyword\"\n              },\n              \"app@shipping@tracking@id\": {\n                \"type\": \"keyword\"\n              },\n              \"app@shipping@zip_code\": {\n                \"type\": \"keyword\"\n              },\n              \"app@synthetic_request\": {\n                \"type\": \"keyword\"\n              },\n              \"app@user@currency\": {\n                \"type\": \"keyword\"\n              },\n              \"app@user@id\": {\n                \"type\": \"keyword\"\n              },\n              \"busy_ns\": {\n                \"type\": \"keyword\"\n              },\n              \"code@filepath\": {\n                \"type\": \"keyword\"\n              },\n              \"code@function\": {\n                \"type\": \"keyword\"\n              },\n              \"code@lineno\": {\n                \"type\": \"keyword\"\n              },\n              \"code@namespace\": {\n                \"type\": \"keyword\"\n              },\n              \"db@instance\": {\n                \"type\": \"keyword\"\n              },\n              \"db@statement\": {\n                \"type\": \"keyword\"\n              },\n              \"db@type\": {\n                \"type\": \"keyword\"\n              },\n              \"db@url\": {\n                \"type\": \"keyword\"\n              },\n              \"decode_time_microseconds\": {\n                \"type\": \"keyword\"\n              },\n              \"http@client_ip\": {\n                \"type\": \"keyword\"\n              },\n              \"http@flavor\": {\n                \"type\": \"keyword\"\n              },\n              \"http@host\": {\n                \"type\": \"keyword\"\n              },\n              \"http@method\": {\n                \"type\": \"keyword\"\n              },\n              \"http@request_content_length\": {\n                \"type\": \"keyword\"\n              },\n              \"http@request_content_length_uncompressed\": {\n                \"type\": \"keyword\"\n              },\n              \"http@response_content_length\": {\n                \"type\": \"keyword\"\n              },\n              \"http@route\": {\n                \"type\": \"keyword\"\n              },\n              \"http@scheme\": {\n                \"type\": \"keyword\"\n              },\n              \"http@status_code\": {\n                \"type\": \"keyword\"\n              },\n              \"http@status_text\": {\n                \"type\": \"keyword\"\n              },\n              \"http@target\": {\n                \"type\": \"keyword\"\n              },\n              \"http@url\": {\n                \"type\": \"keyword\"\n              },\n              \"http@user_agent\": {\n                \"type\": \"keyword\"\n              },\n              \"idle_ns\": {\n                \"type\": \"keyword\"\n              },\n              \"idle_time_microseconds\": {\n                \"type\": \"keyword\"\n              },\n              \"messaging@destination\": {\n                \"type\": \"keyword\"\n              },\n              \"messaging@destination@kind\": {\n                \"type\": \"keyword\"\n              },\n              \"messaging@destination@name\": {\n                \"type\": \"keyword\"\n              },\n              \"messaging@destination_kind\": {\n                \"type\": \"keyword\"\n              },\n              \"messaging@kafka@message@offset\": {\n                \"type\": \"keyword\"\n              },\n              \"messaging@kafka@partition\": {\n                \"type\": \"keyword\"\n              },\n              \"messaging@kafka@source@partition\": {\n                \"type\": \"keyword\"\n              },\n              \"messaging@message@payload_size_bytes\": {\n                \"type\": \"keyword\"\n              },\n              \"messaging@message_id\": {\n                \"type\": \"keyword\"\n              },\n              \"messaging@message_payload_size_bytes\": {\n                \"type\": \"keyword\"\n              },\n              \"messaging@operation\": {\n                \"type\": \"keyword\"\n              },\n              \"messaging@system\": {\n                \"type\": \"keyword\"\n              },\n              \"net@host@ip\": {\n                \"type\": \"keyword\"\n              },\n              \"net@host@name\": {\n                \"type\": \"keyword\"\n              },\n              \"net@host@port\": {\n                \"type\": \"keyword\"\n              },\n              \"net@peer@ip\": {\n                \"type\": \"keyword\"\n              },\n              \"net@peer@name\": {\n                \"type\": \"keyword\"\n              },\n              \"net@peer@port\": {\n                \"type\": \"keyword\"\n              },\n              \"net@sock@peer@addr\": {\n                \"type\": \"keyword\"\n              },\n              \"net@sock@peer@port\": {\n                \"type\": \"keyword\"\n              },\n              \"net@transport\": {\n                \"type\": \"keyword\"\n              },\n              \"phoenix@action\": {\n                \"type\": \"keyword\"\n              },\n              \"phoenix@plug\": {\n                \"type\": \"keyword\"\n              },\n              \"query_time_microseconds\": {\n                \"type\": \"keyword\"\n              },\n              \"queue_time_microseconds\": {\n                \"type\": \"keyword\"\n              },\n              \"rpc@grpc@status_code\": {\n                \"type\": \"keyword\"\n              },\n              \"rpc@method\": {\n                \"type\": \"keyword\"\n              },\n              \"rpc@service\": {\n                \"type\": \"keyword\"\n              },\n              \"rpc@system\": {\n                \"type\": \"keyword\"\n              },\n              \"rpc@user_agent\": {\n                \"type\": \"keyword\"\n              },\n              \"sinatra@template_name\": {\n                \"type\": \"keyword\"\n              },\n              \"source\": {\n                \"type\": \"keyword\"\n              },\n              \"thread@id\": {\n                \"type\": \"keyword\"\n              },\n              \"thread@name\": {\n                \"type\": \"keyword\"\n              },\n              \"total_time_microseconds\": {\n                \"type\": \"keyword\"\n              }\n            }\n          }\n        }\n      },\n      \"spanId\": {\n        \"type\": \"keyword\",\n        \"ignore_above\": 256\n      },\n      \"startTime\": {\n        \"type\": \"date_nanos\"\n      },\n      \"@timestamp\": {\n        \"type\": \"date\"\n      },\n      \"status\": {\n        \"properties\": {\n          \"code\": {\n            \"type\": \"integer\"\n          },\n          \"message\": {\n            \"type\": \"keyword\"\n          }\n        }\n      },\n      \"traceGroup\": {\n        \"type\": \"keyword\",\n        \"ignore_above\": 1024\n      },\n      \"traceGroupFields\": {\n        \"properties\": {\n          \"durationInNanos\": {\n            \"type\": \"long\"\n          },\n          \"endTime\": {\n            \"type\": \"date_nanos\"\n          },\n          \"statusCode\": {\n            \"type\": \"integer\"\n          }\n        }\n      },\n      \"traceId\": {\n        \"type\": \"keyword\",\n        \"ignore_above\": 256\n      },\n      \"traceState\": {\n        \"type\": \"text\",\n        \"fields\": {\n          \"keyword\": {\n            \"type\": \"keyword\",\n            \"ignore_above\": 256\n          }\n        }\n      }\n    }\n  }\n}\n\n# reindex the `otel-v1-apm-span-*` otel span indices to the newly created fixed index\nPOST _reindex\n{\n  \"source\": {\n    \"index\": \"otel-v1-apm-span-*\"\n  },\n  \"dest\": {\n    \"index\": \"otel-v1-apm-span-fixed\"\n  },\n  \"script\": {\n    \"source\": \"ctx._source['@timestamp'] = ctx._source.startTime;\"\n  }\n}\n\n# create a rollup job for an hourly RED Services based index fast aggregation and queries \nPUT _plugins/_rollup/jobs/otel-v1-apm-span-rollup-hour\n{\n  \"rollup\": {\n    \"rollup_id\": \"rollup_REDS_services_metrics_index\",\n    \"enabled\": true,\n    \"schedule\": {\n      \"interval\": {\n        \"start_time\": 1706146764865,\n        \"period\": 1,\n        \"unit\": \"Minutes\",\n        \"schedule_delay\": 0\n      }\n    },\n    \"last_updated_time\": 1706146764865,\n    \"enabled_time\": null,\n    \"description\": \"\",\n    \"schema_version\": 19,\n    \"source_index\": \"otel-v1-apm-span-fixed\",\n    \"target_index\": \"rollup_services_metrics_index\",\n    \"metadata_id\": \"58NGPo0B1DvKaqdigtmw\",\n    \"page_size\": 1000,\n    \"delay\": 0,\n    \"continuous\": true,\n    \"dimensions\": [\n      {\n        \"date_histogram\": {\n          \"fixed_interval\": \"1h\",\n          \"source_field\": \"@timestamp\",\n          \"target_field\": \"@timestamp\",\n          \"timezone\": \"UTC\",\n          \"format\": null\n        }\n      },\n      {\n        \"terms\": {\n          \"source_field\": \"serviceName\",\n          \"target_field\": \"serviceName\"\n        }\n      },\n      {\n        \"terms\": {\n          \"source_field\": \"@timestamp\",\n          \"target_field\": \"@timestamp\"\n        }\n      },\n      {\n        \"histogram\": {\n          \"source_field\": \"status.code\",\n          \"target_field\": \"status.code\",\n          \"interval\": 1\n        }\n      },\n      {\n        \"terms\": {\n          \"source_field\": \"span.attributes.http@status_code\",\n          \"target_field\": \"span.attributes.http@status_code\"\n        }\n      }\n    ],\n    \"metrics\": [\n      {\n        \"source_field\": \"durationInNanos\",\n        \"metrics\": [\n          {\n            \"max\": {}\n          },\n          {\n            \"avg\": {}\n          }\n        ]\n      }\n    ]\n  }\n}\n\n# query the rollup services metrics for the amout of total requests with the aggregation of the different requests http response types\nGET rollup_services_metrics_index/_search\n{\n  \"size\": 0,\n  \"aggs\": {\n    \"time_buckets\": {\n      \"date_histogram\": {\n        \"field\": \"@timestamp\",\n        \"fixed_interval\": \"1h\"\n      },\n      \"aggs\": {\n        \"service_names\": {\n          \"terms\": {\n            \"field\": \"serviceName\",\n            \"order\": {\n              \"_count\": \"desc\"\n            }\n          },\n          \"aggs\": {\n            \"status_codes\": {\n              \"terms\": {\n                \"field\": \"span.attributes.http@status_code\",\n                \"order\": {\n                  \"_count\": \"desc\"\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n}\n\n# Get the average hourly services duration above some given threshold\nGET rollup_services_metrics_index/_search\n{\n      \"size\": 0,\n      \"aggs\": {\n        \"time_buckets\": {\n          \"date_histogram\": {\n            \"field\": \"@timestamp\",\n            \"fixed_interval\": \"1h\"\n          },\n          \"aggs\": {\n            \"service_names\": {\n              \"terms\": {\n                \"field\": \"serviceName\",\n                \"order\": {\n                  \"_count\": \"desc\"\n                }\n              },\n              \"aggs\": {\n                \"average_duration\": {\n                  \"avg\": {\n                    \"field\": \"durationInNanos\"\n                  }\n                },\n                \"duration_filter\": {\n                  \"bucket_selector\": {\n                    \"buckets_path\": {\n                      \"avgDuration\": \"average_duration.value\"\n                    },\n                    \"script\": \"params.avgDuration > ${avg_duration_threshold}\"\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n\n# Get the max hourly services duration above some given threshold\nGET rollup_services_metrics_index/_search\n{\n      \"size\": 0,\n      \"aggs\": {\n        \"time_buckets\": {\n          \"date_histogram\": {\n            \"field\": \"@timestamp\",\n            \"fixed_interval\": \"1h\"\n          },\n          \"aggs\": {\n            \"service_names\": {\n              \"terms\": {\n                \"field\": \"serviceName\",\n                \"order\": {\n                  \"_count\": \"desc\"\n                }\n              },\n              \"aggs\": {\n                \"max_duration\": {\n                  \"max\": {\n                    \"field\": \"durationInNanos\"\n                  }\n                },\n                \"duration_filter\": {\n                  \"bucket_selector\": {\n                    \"buckets_path\": {\n                      \"maxDuration\": \"max_duration.value\"\n                    },\n                    \"script\": \"params.maxDuration > ${max_duration_threshold}\"\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n\n# GET the hourly services errors count\nGET rollup_services_metrics_index/_search\n{\n      \"size\": 0,\n      \"query\": {\n        \"bool\": {\n          \"filter\": [\n            {\n              \"range\": {\n                \"status.code\": {\n                  \"gte\": 2\n                }\n              }\n            }\n          ]\n        }\n      },\n      \"aggs\": {\n        \"time_buckets\": {\n          \"date_histogram\": {\n            \"field\": \"@timestamp\",\n            \"fixed_interval\": \"1h\"\n          },\n          \"aggs\": {\n            \"service_names\": {\n              \"terms\": {\n                \"field\": \"serviceName\",\n                \"order\": {\n                  \"_count\": \"desc\"\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n"}